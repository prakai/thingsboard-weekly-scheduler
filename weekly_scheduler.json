{
  "fqn": "controls.weekly_scheduler",
  "name": "Weekly Scheduler",
  "deprecated": false,
  "image": null,
  "description": "Weekly Scheduler - Example: [1,0111110,17,35,10,1] = Enabled for Sun,Mon,Tue,Wed,Thu, and Fri at 17:35 with 10 minutes, ON",
  "descriptor": {
    "type": "latest",
    "sizeX": 9,
    "sizeY": 1,
    "resources": [],
    "templateHtml": "<div class=\"widget-wrapper\">\n    <div class=\"scheduler-container\" *ngIf=\"ctx.scheduleData\">\n        \n        <div class=\"control-group padded-item\">\n            <button class=\"circle-btn toggle-btn\" [class.active]=\"ctx.scheduleData.enabled\" (click)=\"ctx.toggleEnabled()\">\n                <span class=\"btn-icon\">{{ctx.scheduleData.enabled ? '✓' : '✕'}}</span>\n            </button>\n            <label class=\"control-label\">ENABLE</label>\n        </div>\n        <div class=\"divider\"></div>\n        \n        \n        <div class=\"days-group\">\n            <div class=\"days-row\">\n                <div class=\"day-item\" *ngFor=\"let d of ['S','M','T','W','T','F','S']; let i = index\">\n                    <button class=\"circle-btn day-btn\" [class.active]=\"ctx.getDayActive(i)\" (click)=\"ctx.toggleDay(i)\">\n                        <span class=\"btn-icon\">{{ctx.getDayActive(i) ? '✓' : ''}}</span>\n                    </button>\n                    <span class=\"day-name-label\">{{d}}</span>\n                </div>\n            </div>\n        </div>\n        <div class=\"divider\"></div>\n        \n        \n        <div class=\"control-group fluid-padded\">\n            <input type=\"text\" class=\"time-input\" [(ngModel)]=\"ctx.scheduleData.time\" (blur)=\"ctx.validateTime()\" maxlength=\"5\">\n            <label class=\"control-label\">TIME</label>\n        </div>\n        <div class=\"divider\"></div>\n        \n        \n        <div class=\"control-group fluid-padded\">\n            <input type=\"number\" class=\"period-input\" [(ngModel)]=\"ctx.scheduleData.period\" (change)=\"ctx.onPeriodChange()\" min=\"1\">\n            <label class=\"control-label\">PERIOD</label>\n        </div>\n        <div class=\"divider\"></div>\n        \n        \n        <div class=\"control-group padded-item\">\n            <button class=\"circle-btn state-btn\" [class.active]=\"ctx.scheduleData.state\" (click)=\"ctx.toggleState()\">\n                <span class=\"btn-icon\">{{ctx.scheduleData.state ? '✓' : '✕'}}</span>\n            </button>\n            <label class=\"control-label\">STATE</label>\n        </div>\n    </div>\n</div>",
    "templateCss": ".widget-wrapper {\n    width: 100%;\n    height: 100%;\n    container-type: inline-size; \n}\n\n.scheduler-container {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 2px 0.5cqw 0;\n    box-sizing: border-box;\n    overflow: hidden;\n    --base-font: calc(4px + 0.6cqw); \n    --btn-size: calc(10px + 3.8cqw);\n}\n\n.padded-item {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 0 1.2cqw; \n}\n\n.days-group {\n    flex: 2 1 auto; \n    display: flex;\n    justify-content: center;\n    padding: 0 clamp(4px, 2cqw, 20px);\n}\n\n.days-row {\n    display: flex;\n    gap: clamp(2px, 1.2cqw, 14px);\n    justify-content: center;\n}\n\n.day-item {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 2px;\n}\n\n.fluid-padded {\n    flex: 1 1 auto; \n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 0 1.5cqw; \n}\n\n.divider {\n    width: 1px;\n    height: 36px;\n    background: rgba(0,0,0,0.08);\n    flex-shrink: 0;\n}\n\n.circle-btn {\n    width: var(--btn-size);\n    height: var(--btn-size);\n    max-width: 42px;\n    max-height: 42px;\n    aspect-ratio: 1 / 1;\n    border-radius: 50%;\n    border: 1.5px solid rgba(0,0,0,0.1);\n    background: #fff;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    flex-shrink: 0; \n}\n\n.btn-icon {\n    font-size: calc(var(--base-font) + 3px);\n    font-weight: 900;\n}\n\n.circle-btn.active { color: #fff; border-color: transparent; }\n.toggle-btn.active { background: #10b981; }\n.day-btn.active { background: #3b82f6; }\n.state-btn.active { background: #f59e0b; }\n\n.control-label, .day-name-label {\n    font-size: var(--base-font);\n    font-weight: 900;\n    color: #888;\n    text-transform: uppercase;\n    white-space: nowrap;\n    margin-top: 2px;\n}\n\n.day-name-label { color: #555; }\n\n.time-input, .period-input {\n    width: 100%;\n    height: calc(14px + 3cqw);\n    max-height: 38px;\n    border: 1.5px solid rgba(0,0,0,0.1);\n    text-align: center;\n    font-family: 'Roboto Mono', monospace;\n    font-size: calc(var(--base-font) + 6px);\n    font-weight: 900;\n    border-radius: 4px;\n    background: #fff;\n    outline: none;\n}\n\n.period-input::-webkit-outer-spin-button,\n.period-input::-webkit-inner-spin-button {\n    -webkit-appearance: none;\n    margin: 0;\n}\n.period-input[type=number] {\n    -moz-appearance: textfield;\n}\n\n.time-input { max-width: 88px; min-width: 50px; }\n.period-input { max-width: 52px; min-width: 32px; }",
    "controllerScript": "self.onInit = function() {\n    self.ctx.scheduleData = { enabled: false, days: '0000000', time: '00:00', period: 1, state: false };\n    self.ctx.getDayActive = (i) => self.ctx.scheduleData.days[i] === '1';\n\n    self.ctx.parse = (val) => {\n        try {\n            if (!val || typeof val !== 'string') return;\n            const p = val.replace(/[\\[\\] ]/g, '').split(',');\n            if (p.length < 6) return;\n            self.ctx.scheduleData = {\n                enabled: p[0] === '1',\n                days: p[1].padEnd(7, '0'),\n                time: p[2].padStart(2,'0') + ':' + p[3].padStart(2,'0'),\n                period: parseInt(p[4]) || 1,\n                state: p[5] === '1'\n            };\n        } catch (e) {}\n    };\n\n    self.ctx.update = () => {\n        if (!self.ctx.data || self.ctx.data.length === 0) return;\n        const dk = self.ctx.data[0].dataKey;\n        const entityId = { id: self.ctx.datasources[0].entityId, entityType: self.ctx.datasources[0].entityType };\n        const sd = self.ctx.scheduleData;\n        const t = sd.time.split(':');\n        const val = `[${sd.enabled?'1':'0'},${sd.days},${parseInt(t[0])||0},${parseInt(t[1])||0},${sd.period},${sd.state?'1':'0'}]`;\n        self.ctx.attributeService.saveEntityAttributes(entityId, 'SHARED_SCOPE', [{ key: dk.name, value: val }]).subscribe();\n    };\n\n    self.ctx.toggleEnabled = () => { self.ctx.scheduleData.enabled = !self.ctx.scheduleData.enabled; self.ctx.update(); };\n    self.ctx.toggleState = () => { self.ctx.scheduleData.state = !self.ctx.scheduleData.state; self.ctx.update(); };\n    self.ctx.toggleDay = (i) => {\n        let d = self.ctx.scheduleData.days.split('');\n        d[i] = d[i] === '1' ? '0' : '1';\n        self.ctx.scheduleData.days = d.join('');\n        self.ctx.update();\n    };\n\n    self.ctx.validateTime = () => {\n        const p = (self.ctx.scheduleData.time || '00:00').split(':');\n        const h = Math.min(23, Math.max(0, parseInt(p[0]) || 0));\n        const m = Math.min(59, Math.max(0, parseInt(p[1]) || 0));\n        self.ctx.scheduleData.time = h.toString().padStart(2,'0') + ':' + m.toString().padStart(2,'0');\n        self.ctx.update();\n    };\n\n    self.ctx.onPeriodChange = () => { if(self.ctx.scheduleData.period < 1) self.ctx.scheduleData.period = 1; self.ctx.update(); };\n\n    // Initial Load\n    if (self.ctx.data && self.ctx.data[0] && self.ctx.data[0].data && self.ctx.data[0].data[0]) {\n        self.ctx.parse(self.ctx.data[0].data[0][1]);\n        self.ctx.detectChanges();\n    }\n};\n\n// LIVE UPDATE HANDLER\nself.onDataUpdated = function() {\n    if (self.ctx.data && self.ctx.data[0] && self.ctx.data[0].data && self.ctx.data[0].data[0]) {\n        self.ctx.parse(self.ctx.data[0].data[0][1]);\n        // FORCE UI REPAINT\n        self.ctx.detectChanges();\n    }\n};",
    "typeParameters": "{\"maxDatasources\":1,\"maxDataKeys\":1}",
    "defaultConfig": "{\"showTitle\":false,\"backgroundColor\":\"#ffffff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"0px\",\"settings\":{},\"datasources\":[{\"type\":\"entity\",\"name\":\"device\",\"dataKeys\":[{\"name\":\"scheduler\",\"type\":\"attribute\",\"label\":\"scheduler\"}]}],\"title\":\"Weekly Scheduler\",\"dropShadow\":true,\"enableFullscreen\":false,\"widgetStyle\":{},\"borderRadius\":\"0px\"}"
  }
}
